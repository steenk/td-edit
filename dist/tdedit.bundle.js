!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);let o={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"};function i(e){var t,n,r,a,c=Array.prototype.slice.call(arguments,1),s=[];if("string"!=typeof e)return"[object Array]"===Object.prototype.toString.call(e)?i.apply(this,e):e instanceof window.HTMLElement||e instanceof window.SVGElement?(e.evt=p,e.set=u,e.fun=f,e.ins=h,e.css=d,e.query=e.querySelector,e.queryAll=e.querySelectorAll,e.prototype=e,e):void 0;if(!e||/^[A-Za-z][A-Za-z0-9-_\.:#]*$/.test(e)){for(t=e.split(/([\.#])/),r=0;r<t.length;r++)0===r?(a=t[0].split(":"),n=o[a[0]]?window.document.createElementNS(o[a[0]],a[1]||a[0]):window.document.createElement(a[1]||a[0])):n&&"."===t[r-1]?s.push(t[r]):"#"===t[r-1]&&n.setAttribute("id",t[r]);return s.length>0&&n.setAttribute("class",s.join(" ")),l.call(n,c),n.css=d,n.set=u,n.fun=f,n.evt=p,n.ins=h,n.query=n.querySelector,n.queryAll=n.querySelectorAll,n.prototype=n,n}function l(e){var t,n,r,a,c;for(n=0;n<e.length;n++)if((t=e[n])&&t.nodeType)this.appendChild(t);else if("object"==typeof t)if("[object Array]"===Object.prototype.toString.call(t))this.appendChild(i.apply(this,t));else for(a in t)t.hasOwnProperty(a)&&(/^data[A-Z]/.test(a)?(c=a.substr(4).toLowerCase(),this.setAttribute("data-"+c,t[a])):2===(r=a.split(":")).length&&Object.keys(o).indexOf(r[0])>-1?this.setAttributeNS(o[r[0]],r[1],t[a]):this.setAttribute(a,t[a]));else this.appendChild(window.document.createTextNode(String(t)))}function d(e){var t,n,o;for(t in e)if(e.hasOwnProperty(t))if("object"!=typeof e[t])this.style[t]=e[t];else for(n=this.querySelectorAll(t),o=0;o<n.length;o++)d.call(n[o],e[t]);return this}function u(e,t){return this[e]=t,this}function f(e){var t=Array.prototype.slice.call(arguments,1);return this[e].apply(this,t),this}function p(e,t){if(arguments.length>2){var n=Array.prototype.slice.call(arguments,2);this.addEventListener?this.addEventListener(e,(function(e){var o=[e].concat(n);t.apply(this,o)}),!1):this.attachEvent("on"+e,(function(e){var o=[e].concat(n);t.apply(this,o)}))}else this.addEventListener?this.addEventListener(e,t,!1):this.attachEvent("on"+e,t);return this}function h(){return l.call(this,Array.prototype.slice.call(arguments)),this}console.log('$$$: not a valid ident parameter "'+e+'".')}var r,a,c,s,l;function d(e){return["i"].concat(e.split(/\s/).filter(e=>"active"!==e&&e)).join(".")}i.version="1.5.4",i.structify=function(e,t){var n,o=null;return 1===e.nodeType&&(n=function(e){var o,i,r,a,c,s=[],l=/id|class|contenteditable/,d=e.localName,u=String(e.getAttribute("class")||"").replace(/\s/g,".");if(u&&(d+="."+u),e.id&&(d+="#"+e.id),s.push(d),e.hasAttributes()){for(i=e.attributes,o={},c=0;c<i.length;c++)l.test(i[c].name)||(o[i[c].name]=i[c].value);Object.keys(o).length>0&&s.push(o)}for(e.normalize(),r=e.childNodes,c=0;c<r.length;c++)3===r[c].nodeType?(a=t?r[c].data.replace(/\s\s*/," ").trim():r[c].data).length>0&&s.push(a):1===r[c].nodeType&&s.push(n(r[c]));return s},o=n(e)),o},i.onReady=function(e){"complete"===window.document.readyState||"interactive"===window.document.readyState?r(e):window.document.addEventListener?window.document.addEventListener("DOMContentLoaded",e,!1):window.document.attachEvent("onreadystatechange",e)},"function"==typeof setImmediate?r=setImmediate:window.setImmediate?r=window.setImmediate:(c=[],s="doNext"+(67108864*Math.random()|0).toString(16),a=function(e){var t,n;e.source===window&&"string"==typeof e.data&&0===e.data.indexOf(s)&&((n=c.shift()).length>0&&(t=n[0].apply(void 0,n.splice(1),!0),c[0]&&1===c[0].length&&c[0].push(t)))},window.postMessage?window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent("message",a):window.postMessage=function(e){window.setTimeout((function(){a({source:window,data:e})}),0)},r=function(){var e=Array.prototype.slice.call(arguments);"function"==typeof e[0]&&(c.push(e),window.postMessage(s,"*"))}),i.setImmediate=r,i.appendToDoc=function e(){function t(e){var t;i.onReady((function(){for(n=0;n<o.length;n++)"[object Array]"===Object.prototype.toString.call(o[n])?(t=i.apply(this,o[n]))&&window.document.body.appendChild(t):o[n]instanceof window.Element?window.document.body.appendChild(o[n]):"function"==typeof o[n]&&o[n]();e()}))}var n,o=Array.prototype.slice.call(arguments),a=[];return e.then=function(t){if(e===t)throw new TypeError("Circular reference.");return"function"==typeof t?a.push(t):console.log('$$$: Only functions can be passed to "then()"!'),e},e.catch=function(t){return console.log("$$$: Error occured.",t),e},"undefined"!=typeof Promise?new Promise((function(e,n){try{t(e)}catch(e){n(e)}})):(t((function(){var e;a.forEach((function(t){r((function(){e&&e.then?e.then((function(e){t(e)})):e=t(e)}))}))})),e)},i.query=function(e){return window.document.querySelector(e)},i.queryAll=function(e){return window.document.querySelectorAll(e)};let u={cite:"quote-right"};function f(e,t,n){for(var o=!1,r=1===e.nodeType?e:e.parentElement;!r.classList.contains("td-edit-textarea");)l[r.tagName]===t&&(o=!0),r=r.parentNode;if(n[t]&&!o){console.log(t+" should be created");let e=document.getSelection(),n=e.getRangeAt(0),o=i(l[t]("-"));n.insertNode(o),e.selectAllChildren(o)}return!n[t]&&o&&console.log(t+" should be removed"),o}var p={run:function(e,t){if(t=u[t]||t,l[t]){let n=document.getSelection(),o=e.selection;if(!o.focusNode||o.focusNode.length<o.focusOffset)return;if(n.setBaseAndExtent(o.anchorNode,o.anchorOffset,o.focusNode,o.focusOffset),n.rangeCount){let o=n.getRangeAt(0);if("Range"===n.type){let e=l[t](n.toString());return o.deleteContents(),o.insertNode(i(e)),void n.empty()}"Caret"===n.type&&console.log(e.toolbarId)}}},check:function(e){return l[e]?e:"angry"},mapToFA:function(e){return l[e]},remove:function(e,t){document.getSelection();let n=e.selection.anchorNode.parentElement;l[n.tagName]&&l[n.tagName]===t&&n.parentNode.replaceChild(e.selection.anchorNode,n)},setStyle:function(e,t){let n=document.getSelection(),o=e.selection;n.setBaseAndExtent(o.anchorNode,o.anchorOffset,o.focusNode,o.focusOffset);for(let e in t)f(o.anchorNode,e,t)},create:function(e){let t={};return e.tools.forEach(e=>{let n=d(e.classes);t[n]=t=>(t=t||"",JSON.parse(e.template.replace(/\$selection/g,"'"+t+"'").replace(/'/g,'"'))),t[function(e){return(/^\s*\[\s*[\'\"](.+)[\'\"]/.exec(e)[1]||"").toUpperCase()}(e.template)]=n}),l=t,{knownAction:t}},toolKey:d},h={tools:[{title:"Bold",classes:"td-button icon-bold",template:"['strong', $selection]"},{title:"Italic",classes:"td-button icon-italic",template:"['em', $selection]"},{title:"Mark",classes:"td-button icon-underline",template:"['mark', $selection]"},{title:"Large heading",classes:"td-button icon-heading one",template:"['h1', $selection]"},{title:"Middle heading",classes:"td-button icon-heading two",template:"['h2', $selection]"},{title:"Small heading",classes:"td-button icon-heading three",template:"['h3', $selection]"},{title:"Code",classes:"td-button icon-code",template:"['code', $selection]"}]};const y=new Event("change");function m(e,t){return String(e).toLowerCase()+"."+t.split(/\s/).join(".")}function g(e,t,n){if("I"===e.target.tagName){let o=e.target,i=document.getElementById(n),r=document.getElementById("TA"+n.substring(2)),a=p.toolKey(o.className);o.classList.contains("active")?(o.classList.remove("active"),t.remove(r,a)):"Caret"===r.selection.type?(o.classList.toggle("active"),t.setStyle(r,function(e){let t=e.queryAll("i"),n={};return Array.from(t).forEach(e=>{n[p.toolKey(e.className)]=e.classList.contains("active")}),n}(i))):"Range"===r.selection.type&&t.run(r,a)}}function v(e,t,n,o){!function(e){let t=e.queryAll(".active");Array.from(t).forEach(e=>{e.classList.remove("active")})}(o);let i=document.getSelection();if(!i.anchorNode)return void console.log("no anchor",i.type);for(let e of["anchorNode","focusNode","anchorOffset","focusOffset","isCollapsed","rangeCount","type"])n.selection[e]=i[e];let r=i.anchorNode.parentNode;if(!r.classList.contains("td-edit-textarea")){let e=t.mapToFA(r.tagName),n=o.querySelector(e);n&&n.classList.add("active")}}var w={version:"0.3.0",init:function(e){e=e||h,p.create(e);let t=i.queryAll(".td-rich-editor");Array.from(t).forEach(t=>{let n=1e18*Math.random();i(t),t.id="ED"+n;var o=t.query(".td-edit-toolbar");o||(o=i("div.td-edit-toolbar"),t.ins(o),e.tools.forEach(e=>{p.check(e);o.ins([m("i",e.classes),{title:e.title}])})),o.id="TB"+n,o.evt("click",g,p,o.id);var r=t.query(".td-edit-textarea");r||(r=i("div.td-edit-textarea"),t.ins(r)),r.setAttribute("contenteditable",!0),r.id="TA"+n,r.toolbarId="TB"+n,r.selection={},r.evt("change",v,p,r,o),r.evt("keyup",e=>{r.dispatchEvent(y)}),r.evt("click",e=>{r.dispatchEvent(y)})})}};document.onreadystatechange=function(){"complete"===document.readyState&&w.init()}}]);